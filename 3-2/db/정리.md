#### Oracle 
- 중첩 질의 결과가 테이블인 경우 이를 `AS`로 renaming 못함. `AS`를 쓰지 않는다.

#### 중첩 질의 결과
- 값인 경우(`max`, `count`, `min`, `count` 등) 결과에 대해 >, = 등의 비교 연산이 가능하다.
- 테이블인 경우 집합이므로 `ALL`, `EVERY`, `IN`, `EXIST` 등의 연산이 가능하다.

#### GROUP BY
- `GROUP BY`의 결과는 반드시 single-value group이어야한다.
- 그룹별로 2개의 결과가 나와서는 안된다.
- `SELECT`절에 있는 column은 `GROUP BY`절에 반드시 등장해야한다.
- `GROUP BY`절에 있는 column의 `HAVING`절에 오거나 `HAVING`절의 column은 `SELECT`의 집단 연산의 인수이다.
  
  
    |rating|count|
    |-|-|
    |3|2|
    |3|4|


- 문제 5.4
```sql
CREATE TABLE EMP(
 	EID  NUMBER(5) PRIMARY KEY, 
	ENAME    VARCHAR2(20) NOT NULL,
	AGE NUMBER(2,1)
 	SALARY NUMBER(4,2),
);

CREATE TABLE WORKS(
 	EID  NUMBER(5) PRIMARY KEY,
	DID NUMBER(4,1) PRIMARY KEY,
	PCT_TIME NUMBER(4,2)
	);

-- ex1
SELECT e.ename, e.age
FROM EMP e
WHERE e.eid IN (
    SELECT w.EID
    FROM WORKS w
    WHERE w.did IN (
        SELECT d.did
        FROM DEPT d
        WHERE d.dname='Hardware'
    )
    INTERSECT
    SELECT w2.eid
    FROM WORKS w2
    WHERE w2.DID IN (
        SELECT d.did
        FROM DEPT d
        WHERE d.dname='Software'
    )
)

-- ex2
-- 전일제-상당
-- Full time 1명, half-time 2명일 때 sum은 200%이다.
SELECT W.DID
FROM WORKS W
GROUP BY W.DID
HAVING 2000 < (
	SELECT SUM(PCT_TIME)
	FROM WORK W
	);
-- ex3
SELECT E.ENAME 
FROM EMP E 
WHERE E.SALARY > ALL(
		SELECT D.BUDGET
		FROM DEPT D, WORKS W
		WHERE D.DID = W.DID AND E.EID = W.EID
		);
-- ex4
SELECT D.MANAGERID
FROM DEPT D
WHERE 1000000 <ALL(
	SELECT D1.BUDGET
	FROM DEPT D1
	);
-- ex5
SELECT E.ENAME
FROM EMP E, DEPT D
WHERE E.EID = D.MANAGERID AND D.DID IN(
	SELECT D2.DID
	FROM DEPT D2
	WHERE D2.BUDGET IN(
		SELECT MAX(D3.BUDGET FROM DEPT D3)
		)
	);
-- ex6
SELECT D.MANAGERID
FROM DEPT D
WHERE 5000000 <(
	SELECT SUM(D1.BUDGET)
	FROM DEPT D1
	WHERE D1.MANAGERID = D.MANAGERID
	);
-- ex8
SELECT E.NAME 
FROM E.EID = D.MANAGERID
GROUP BY E.EID, E.ENAME
HAVING EVERY (D.BUDGET > 1000000)
AND ANY (BUDGET<5000000)
```

```SQL
-- 1


-- 2 
SELECT W.DID, COUNT(*)
FROM WORKS W
GROUP BY W.DID
HAVING SUM(W.PCT_TIME) > 2000
-- HAVING에 들어가려면 집단 연산자의 인수로 들어가거나 GROUPING 할때에 들어가 있어야한다.
-- 3
SELECT E.ENAME
FROM EMP E
WHERE E.SALARY > ALL(
    SELECT D.BUDGET
    FROM DEPT D, WORKS W
    WHERE E.EID = W.EID AND W.DID = D.DID
)

-- 4 
(SELECT DISTINCT D.MANAGERID
FROM DEPT D)
MINUS
(SELECT DISTINCT D.MANAGERID
FROM DEPT D2
WHERE D2.BUDGET = 1000000)
-- 5
SELECT E.ENAME
FROM EMP E, DEPT D
WHERE D.MANAGERID = E.EID AND D.BUDGET = (
    SELECT MAX(D2.BUDGET)
    FROM DEPT D2
)

-- 6
SELECT D.MANAGERID
FROM DEPT D
GROUP BY D.MANAGERID
HAVING SUM(D.BUDGET) > 5000000

-- 7
SELECT D.MANAGERID
FROM DEPT D
GROUP BY D.MANAGERID
HAVING SUM(D.BUDGET) >= ALL (
    SELECT SUM(D2.BUDGET)
    FROM DEPT D2
    GROUP BY D2.MANAGERID
)
-- 8
SELECT E.ENAME
FROM DEPT D, EMP E
WHERE D.MANAGERID = E.EID
GROUP BY E.EID, E.ENAME -- 이름이 같을 수 있다.
HAVING EVERY(D.BUDGET>1000000) AND ANY (D.BUDGET<5000000)


SELECT E.NAME 
FROM E.EID = D.MANAGERID
GROUP BY E.EID, E.ENAME
HAVING EVERY (D.BUDGET > 1000000)
AND ANY (BUDGET<5000000)


-- 145 page 정독
-- 5장 정독
-- 1번 8번 문제 주의깊게 보자 !
```